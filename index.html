<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Annonse-Analyser | AI Fokusgruppe for Annonser</title>
    <meta name="description" content="Test annonsen din p√• en AI-drevet fokusgruppe f√∏r du bruker penger p√• annonsering.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéØ</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        .tab-active { border-bottom: 3px solid #2563eb; color: #2563eb; }
        .copy-btn:active { transform: scale(0.95); }
        .score-bar { transition: width 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        .priority-card { animation: fadeIn 0.4s ease-out forwards; }
        .priority-card:nth-child(1) { animation-delay: 0.1s; }
        .priority-card:nth-child(2) { animation-delay: 0.2s; }
        .priority-card:nth-child(3) { animation-delay: 0.3s; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        function AdPredictionAgent() {
            const [step, setStep] = useState(1);
            const [business, setBusiness] = useState('');
            const [audience, setAudience] = useState('');
            const [adText, setAdText] = useState('');
            const [adImage, setAdImage] = useState(null);
            const [imagePreview, setImagePreview] = useState(null);
            const [loading, setLoading] = useState(false);
            const [sections, setSections] = useState(null);
            const [activeTab, setActiveTab] = useState('personas');
            const [error, setError] = useState('');
            const [copiedIndex, setCopiedIndex] = useState(null);
            const [copiedPriority, setCopiedPriority] = useState(null);

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 5 * 1024 * 1024) {
                        setError('Bildet er for stort. Maks 5MB.');
                        return;
                    }
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setAdImage(reader.result);
                        setImagePreview(reader.result);
                        setError('');
                    };
                    reader.readAsDataURL(file);
                }
            };

            const copyToClipboard = (text, index, type = 'hook') => {
                navigator.clipboard.writeText(text);
                if (type === 'priority') {
                    setCopiedPriority(index);
                    setTimeout(() => setCopiedPriority(null), 2000);
                } else {
                    setCopiedIndex(index);
                    setTimeout(() => setCopiedIndex(null), 2000);
                }
            };

            const generateFeedback = async () => {
                setLoading(true);
                setError('');

                try {
                    const response = await fetch("/api/analyze", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ business, audience, adText, adImage })
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.error || 'Noe gikk galt');
                    }
                    
                    setSections(data.sections);
                    setActiveTab('personas');
                    setStep(4);
                } catch (error) {
                    console.error("Feil:", error);
                    setError(`Feil: ${error.message}. Pr√∏v igjen.`);
                }
                
                setLoading(false);
            };

            const resetForm = () => {
                setStep(1);
                setBusiness('');
                setAudience('');
                setAdText('');
                setAdImage(null);
                setImagePreview(null);
                setSections(null);
                setError('');
            };

            const parsePriorities = (text) => {
                if (!text) return [];
                const priorities = [];
                const blocks = text.split('**').filter(b => b.trim());
                
                for (let i = 0; i < blocks.length; i += 2) {
                    const titleBlock = blocks[i];
                    const contentBlock = blocks[i + 1] || '';
                    
                    const titleMatch = titleBlock.match(/^\d+\.\s*(.+)/);
                    if (titleMatch) {
                        const whyMatch = contentBlock.match(/Hvorfor:\s*([^\n]+)/);
                        const doMatch = contentBlock.match(/Gj√∏r dette:\s*([\s\S]*?)(?=\*\*|$)/);
                        
                        priorities.push({
                            title: titleMatch[1].trim(),
                            why: whyMatch ? whyMatch[1].trim() : '',
                            action: doMatch ? doMatch[1].trim() : ''
                        });
                    }
                }
                return priorities;
            };

            const parsePersonas = (text) => {
                if (!text) return [];
                const personas = [];
                const personaBlocks = text.split('**PERSONA').filter(p => p.trim());
                
                personaBlocks.forEach(block => {
                    const typeMatch = block.match(/^\s*\d+:\s*([^\*\n]+)/);
                    const nameMatch = block.match(/Navn:\s*([^\n]+)/);
                    const profileMatch = block.match(/Profil:\s*([^\n]+)/);
                    const reactionMatch = block.match(/Min umiddelbare reaksjon:\s*([\s\S]*?)(?=Hva treffer meg:|$)/);
                    const hitsMatch = block.match(/Hva treffer meg:\s*([\s\S]*?)(?=Hva skurrer:|$)/);
                    const missMatch = block.match(/Hva skurrer:\s*([\s\S]*?)(?=Mitt forslag:|$)/);
                    const suggestionMatch = block.match(/Mitt forslag:\s*([\s\S]*?)(?=\*\*PERSONA|$)/);

                    if (nameMatch) {
                        personas.push({
                            type: typeMatch ? typeMatch[1].trim() : '',
                            name: nameMatch[1].trim(),
                            profile: profileMatch ? profileMatch[1].trim() : '',
                            reaction: reactionMatch ? reactionMatch[1].trim() : '',
                            hits: hitsMatch ? hitsMatch[1].trim() : '',
                            misses: missMatch ? missMatch[1].trim() : '',
                            suggestion: suggestionMatch ? suggestionMatch[1].trim() : ''
                        });
                    }
                });
                return personas;
            };

            const parseScoring = (text) => {
                if (!text) return null;
                const scores = {};
                
                const attentionMatch = text.match(/Oppmerksomhet:\s*(\d+)\/10\s*\n([^\n]+)/);
                const relevanceMatch = text.match(/Relevans:\s*(\d+)\/10\s*\n([^\n]+)/);
                const clarityMatch = text.match(/Klarhet:\s*(\d+)\/10\s*\n([^\n]+)/);
                const ctaMatch = text.match(/CTA-styrke:\s*(\d+)\/10\s*\n([^\n]+)/);
                const totalMatch = text.match(/Totalvurdering:\s*(\d+)\/10/);

                if (attentionMatch) scores.attention = { score: parseInt(attentionMatch[1]), reason: attentionMatch[2].trim() };
                if (relevanceMatch) scores.relevance = { score: parseInt(relevanceMatch[1]), reason: relevanceMatch[2].trim() };
                if (clarityMatch) scores.clarity = { score: parseInt(clarityMatch[1]), reason: clarityMatch[2].trim() };
                if (ctaMatch) scores.cta = { score: parseInt(ctaMatch[1]), reason: ctaMatch[2].trim() };
                if (totalMatch) scores.total = parseInt(totalMatch[1]);

                return scores;
            };

            const parseHooks = (text) => {
                if (!text) return [];
                const hooks = [];
                const lines = text.split('\n');
                lines.forEach(line => {
                    const match = line.match(/^\d+\.\s*(.+)/);
                    if (match) {
                        hooks.push(match[1].trim());
                    }
                });
                return hooks;
            };

            const parseObjections = (text) => {
                if (!text) return [];
                const objections = [];
                const blocks = text.split('**Innvending').filter(b => b.trim());
                
                blocks.forEach(block => {
                    const objMatch = block.match(/\d+:\s*"([^"]+)"/);
                    const handleMatch = block.match(/Slik kan du h√•ndtere den i annonsen:\s*([\s\S]*?)(?=\*\*Innvending|$)/);
                    
                    if (objMatch) {
                        objections.push({
                            objection: objMatch[1].trim(),
                            handling: handleMatch ? handleMatch[1].trim() : ''
                        });
                    }
                });
                return objections;
            };

            const ScoreBar = ({ label, score, reason }) => {
                const getColor = (s) => {
                    if (s >= 8) return 'bg-green-500';
                    if (s >= 6) return 'bg-yellow-500';
                    if (s >= 4) return 'bg-orange-500';
                    return 'bg-red-500';
                };

                return (
                    <div className="mb-4">
                        <div className="flex justify-between mb-1">
                            <span className="font-medium text-gray-700">{label}</span>
                            <span className="font-bold text-gray-900">{score}/10</span>
                        </div>
                        <div className="w-full bg-gray-200 rounded-full h-3 mb-2">
                            <div 
                                className={`h-3 rounded-full score-bar ${getColor(score)}`} 
                                style={{ width: `${score * 10}%` }}
                            ></div>
                        </div>
                        <p className="text-sm text-gray-600">{reason}</p>
                    </div>
                );
            };

            const PriorityCard = ({ priority, index }) => {
                const numbers = ['1', '2', '3'];
                const colors = [
                    'from-amber-500 to-orange-500',
                    'from-blue-500 to-indigo-500', 
                    'from-emerald-500 to-teal-500'
                ];

                return (
                    <div className="priority-card opacity-0 bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-shadow">
                        <div className={`bg-gradient-to-r ${colors[index]} px-4 py-3 flex items-center gap-3`}>
                            <div className="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center text-white font-bold">
                                {numbers[index]}
                            </div>
                            <h3 className="font-semibold text-white">{priority.title}</h3>
                        </div>
                        <div className="p-4">
                            <p className="text-sm text-gray-600 mb-3">
                                <span className="font-medium">Hvorfor:</span> {priority.why}
                            </p>
                            <div className="bg-gray-50 rounded-lg p-3 relative group">
                                <p className="text-sm font-medium text-gray-500 mb-1">Gj√∏r dette:</p>
                                <p className="text-gray-800 pr-16">{priority.action}</p>
                                <button
                                    onClick={() => copyToClipboard(priority.action, index, 'priority')}
                                    className={`absolute top-3 right-3 text-xs px-3 py-1.5 rounded-lg transition-all ${
                                        copiedPriority === index
                                            ? 'bg-green-100 text-green-700'
                                            : 'bg-gray-200 text-gray-600 hover:bg-blue-100 hover:text-blue-700'
                                    }`}
                                >
                                    {copiedPriority === index ? '‚úì Kopiert!' : 'Kopier'}
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            const PersonaCard = ({ persona, index }) => {
                const colors = [
                    { bg: 'bg-red-50', border: 'border-red-200', icon: 'bg-red-500', badge: 'bg-red-100 text-red-700' },
                    { bg: 'bg-blue-50', border: 'border-blue-200', icon: 'bg-blue-500', badge: 'bg-blue-100 text-blue-700' },
                    { bg: 'bg-green-50', border: 'border-green-200', icon: 'bg-green-500', badge: 'bg-green-100 text-green-700' }
                ];
                const color = colors[index % 3];

                return (
                    <div className={`${color.bg} ${color.border} border rounded-xl p-5 mb-4`}>
                        <div className="flex items-center gap-3 mb-4">
                            <div className={`w-12 h-12 ${color.icon} rounded-full flex items-center justify-center text-white font-bold text-lg`}>
                                {persona.name.charAt(0)}
                            </div>
                            <div>
                                <p className="font-semibold text-gray-800">{persona.name}</p>
                                <span className={`text-xs px-2 py-1 rounded-full ${color.badge}`}>{persona.type}</span>
                            </div>
                        </div>
                        <p className="text-sm text-gray-600 italic mb-4">{persona.profile}</p>
                        
                        <div className="space-y-3">
                            <div>
                                <p className="font-medium text-gray-700 mb-1">üí≠ Min reaksjon:</p>
                                <p className="text-gray-600 text-sm">{persona.reaction}</p>
                            </div>
                            <div>
                                <p className="font-medium text-gray-700 mb-1">‚úÖ Hva treffer:</p>
                                <p className="text-gray-600 text-sm">{persona.hits}</p>
                            </div>
                            <div>
                                <p className="font-medium text-gray-700 mb-1">‚ùå Hva skurrer:</p>
                                <p className="text-gray-600 text-sm">{persona.misses}</p>
                            </div>
                            <div className="bg-white/50 rounded-lg p-3 mt-3">
                                <p className="font-medium text-gray-700 mb-1">üí° Mitt forslag:</p>
                                <p className="text-gray-700 text-sm">{persona.suggestion}</p>
                            </div>
                        </div>
                    </div>
                );
            };

            const renderResults = () => {
                const priorities = parsePriorities(sections?.priorities);
                const personas = parsePersonas(sections?.personas);
                const scoring = parseScoring(sections?.scoring);
                const hooks = parseHooks(sections?.hooks);
                const objections = parseObjections(sections?.objections);

                return (
                    <div className="space-y-6">
                        {/* Priority Actions - Always visible at top */}
                        {priorities.length > 0 && (
                            <div className="fade-in">
                                <div className="flex items-center gap-2 mb-4">
                                    <span className="text-2xl">üöÄ</span>
                                    <h2 className="text-xl font-bold text-gray-800">Fiks dette f√∏rst</h2>
                                </div>
                                <div className="grid gap-4">
                                    {priorities.map((priority, i) => (
                                        <PriorityCard key={i} priority={priority} index={i} />
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Divider */}
                        <div className="border-t border-gray-200 pt-6">
                            <p className="text-sm text-gray-500 mb-4">Utforsk detaljert analyse:</p>
                        </div>

                        {/* Tabs */}
                        <div className="flex border-b border-gray-200 overflow-x-auto">
                            {[
                                { id: 'personas', label: 'üë• Personas', count: personas.length },
                                { id: 'scoring', label: 'üìä Score', count: scoring?.total },
                                { id: 'hooks', label: 'üé£ Hooks', count: hooks.length },
                                { id: 'objections', label: 'üõ°Ô∏è Innvendinger', count: objections.length }
                            ].map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`px-4 py-3 font-medium text-sm whitespace-nowrap transition-colors ${
                                        activeTab === tab.id 
                                            ? 'tab-active' 
                                            : 'text-gray-500 hover:text-gray-700'
                                    }`}
                                >
                                    {tab.label}
                                    {tab.count && (
                                        <span className="ml-2 bg-gray-100 text-gray-600 text-xs px-2 py-0.5 rounded-full">
                                            {tab.count}
                                        </span>
                                    )}
                                </button>
                            ))}
                        </div>

                        {/* Tab Content */}
                        <div className="min-h-[300px]">
                            {/* Personas Tab */}
                            {activeTab === 'personas' && (
                                <div>
                                    <p className="text-gray-600 mb-4">Tre ulike perspektiver fra din m√•lgruppe:</p>
                                    {personas.map((persona, i) => (
                                        <PersonaCard key={i} persona={persona} index={i} />
                                    ))}
                                </div>
                            )}

                            {/* Scoring Tab */}
                            {activeTab === 'scoring' && scoring && (
                                <div>
                                    <div className="bg-gradient-to-r from-blue-600 to-blue-800 rounded-xl p-6 mb-6 text-white text-center">
                                        <p className="text-blue-100 mb-1">Totalvurdering</p>
                                        <p className="text-5xl font-bold">{scoring.total}/10</p>
                                    </div>
                                    
                                    <div className="bg-white border border-gray-200 rounded-xl p-6">
                                        {scoring.attention && <ScoreBar label="üéØ Oppmerksomhet" score={scoring.attention.score} reason={scoring.attention.reason} />}
                                        {scoring.relevance && <ScoreBar label="üë• Relevans" score={scoring.relevance.score} reason={scoring.relevance.reason} />}
                                        {scoring.clarity && <ScoreBar label="üí° Klarhet" score={scoring.clarity.score} reason={scoring.clarity.reason} />}
                                        {scoring.cta && <ScoreBar label="üëÜ CTA-styrke" score={scoring.cta.score} reason={scoring.cta.reason} />}
                                    </div>
                                </div>
                            )}

                            {/* Hooks Tab */}
                            {activeTab === 'hooks' && (
                                <div>
                                    <p className="text-gray-600 mb-4">Klikk for √• kopiere ‚Äì klar til √• teste:</p>
                                    <div className="space-y-2">
                                        {hooks.map((hook, i) => (
                                            <div 
                                                key={i}
                                                onClick={() => copyToClipboard(hook, i)}
                                                className="bg-white border border-gray-200 rounded-lg p-4 cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-colors group"
                                            >
                                                <div className="flex justify-between items-start gap-3">
                                                    <p className="text-gray-800">{hook}</p>
                                                    <span className={`text-xs px-2 py-1 rounded transition-colors copy-btn ${
                                                        copiedIndex === i 
                                                            ? 'bg-green-100 text-green-700' 
                                                            : 'bg-gray-100 text-gray-500 group-hover:bg-blue-100 group-hover:text-blue-700'
                                                    }`}>
                                                        {copiedIndex === i ? '‚úì Kopiert!' : 'Kopier'}
                                                    </span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Objections Tab */}
                            {activeTab === 'objections' && (
                                <div>
                                    <p className="text-gray-600 mb-4">Slik h√•ndterer du innvendingene i annonsen:</p>
                                    <div className="space-y-4">
                                        {objections.map((obj, i) => (
                                            <div key={i} className="bg-white border border-gray-200 rounded-xl overflow-hidden">
                                                <div className="bg-red-50 px-4 py-3 border-b border-red-100">
                                                    <p className="font-medium text-red-800">‚ùì "{obj.objection}"</p>
                                                </div>
                                                <div className="px-4 py-3 bg-green-50">
                                                    <p className="text-sm text-gray-600 mb-1">üí¨ Slik svarer du:</p>
                                                    <p className="text-gray-800">{obj.handling}</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Action buttons */}
                        <div className="flex gap-3 pt-4 border-t border-gray-200">
                            <button
                                onClick={() => { setStep(3); setSections(null); setError(''); }}
                                className="py-3 px-6 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors"
                            >
                                ‚Üê Test annen annonse
                            </button>
                            <button
                                onClick={resetForm}
                                className="flex-1 py-3 px-6 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
                            >
                                Start p√• nytt
                            </button>
                        </div>
                    </div>
                );
            };

            const renderStep = () => {
                switch(step) {
                    case 1:
                        return (
                            <div className="space-y-4">
                                <div>
                                    <h2 className="text-xl font-semibold text-gray-800 mb-2">Fortell om bedriften din</h2>
                                    <p className="text-gray-600 mb-4">Hva selger du, og hva gj√∏r bedriften din unik?</p>
                                </div>
                                <textarea
                                    value={business}
                                    onChange={(e) => setBusiness(e.target.value)}
                                    placeholder="F.eks: Vi driver et bilpleiefirma i √Ölesund som spesialiserer seg p√• keramisk coating og lakkforsegling. Vi fokuserer p√• premium kvalitet og bruker kun profesjonelle produkter..."
                                    className="w-full h-40 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                                />
                                <button
                                    onClick={() => setStep(2)}
                                    disabled={!business.trim()}
                                    className="w-full py-3 px-6 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
                                >
                                    Neste ‚Üí
                                </button>
                            </div>
                        );

                    case 2:
                        return (
                            <div className="space-y-4">
                                <div>
                                    <h2 className="text-xl font-semibold text-gray-800 mb-2">Beskriv m√•lgruppen din</h2>
                                    <p className="text-gray-600 mb-4">Hvem pr√∏ver du √• n√•? Jo mer detaljer, jo bedre tilbakemelding.</p>
                                </div>
                                <textarea
                                    value={audience}
                                    onChange={(e) => setAudience(e.target.value)}
                                    placeholder="F.eks: Menn 35-55 √•r i M√∏re og Romsdal, har bil til 400.000+, er opptatt av √• ta vare p√• bilen sin, har gjerne pr√∏vd billig bilvask men er misforn√∏yd med resultatet. Verdsetter kvalitet og er villig til √• betale ekstra for profesjonelt arbeid..."
                                    className="w-full h-40 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                                />
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => setStep(1)}
                                        className="py-3 px-6 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors"
                                    >
                                        ‚Üê Tilbake
                                    </button>
                                    <button
                                        onClick={() => setStep(3)}
                                        disabled={!audience.trim()}
                                        className="flex-1 py-3 px-6 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
                                    >
                                        Neste ‚Üí
                                    </button>
                                </div>
                            </div>
                        );

                    case 3:
                        return (
                            <div className="space-y-4">
                                <div>
                                    <h2 className="text-xl font-semibold text-gray-800 mb-2">Last opp annonsen din</h2>
                                    <p className="text-gray-600 mb-4">Lim inn annonseteksten og last opp bildet.</p>
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Annonsetekst</label>
                                    <textarea
                                        value={adText}
                                        onChange={(e) => setAdText(e.target.value)}
                                        placeholder="Lim inn hele annonseteksten her..."
                                        className="w-full h-32 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Annonsebilde (valgfritt)</label>
                                    <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors">
                                        {imagePreview ? (
                                            <div className="space-y-3">
                                                <img src={imagePreview} alt="Forh√•ndsvisning" className="max-h-48 mx-auto rounded-lg" />
                                                <button
                                                    onClick={() => { setAdImage(null); setImagePreview(null); }}
                                                    className="text-red-600 text-sm hover:underline"
                                                >
                                                    Fjern bilde
                                                </button>
                                            </div>
                                        ) : (
                                            <div>
                                                <input
                                                    type="file"
                                                    accept="image/*"
                                                    onChange={handleImageUpload}
                                                    className="hidden"
                                                    id="image-upload"
                                                />
                                                <label htmlFor="image-upload" className="cursor-pointer">
                                                    <div className="text-gray-500">
                                                        <svg className="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                                        </svg>
                                                        <p className="mt-2">Klikk for √• laste opp bilde</p>
                                                        <p className="text-sm text-gray-400">PNG, JPG, GIF (maks 5MB)</p>
                                                    </div>
                                                </label>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {error && <p className="text-red-600 text-sm bg-red-50 p-3 rounded-lg">{error}</p>}

                                <div className="flex gap-3">
                                    <button
                                        onClick={() => setStep(2)}
                                        className="py-3 px-6 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors"
                                    >
                                        ‚Üê Tilbake
                                    </button>
                                    <button
                                        onClick={generateFeedback}
                                        disabled={!adText.trim() || loading}
                                        className="flex-1 py-3 px-6 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
                                    >
                                        {loading ? (
                                            <span className="flex items-center justify-center gap-2">
                                                <svg className="animate-spin h-5 w-5" viewBox="0 0 24 24">
                                                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none" />
                                                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
                                                </svg>
                                                Analyserer (10-20 sek)...
                                            </span>
                                        ) : (
                                            "üéØ Analyser annonsen"
                                        )}
                                    </button>
                                </div>
                            </div>
                        );

                    case 4:
                        return renderResults();

                    default:
                        return null;
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 p-4">
                    <div className="max-w-2xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-xl overflow-hidden">
                            <div className="bg-gradient-to-r from-blue-600 to-blue-800 px-6 py-8 text-white">
                                <h1 className="text-2xl font-bold mb-2">üéØ Annonse-Analyser</h1>
                                <p className="text-blue-100">F√• √¶rlig tilbakemelding p√• annonsen din fra AI-fokusgruppe</p>
                                
                                {step < 4 && (
                                    <div className="flex gap-2 mt-6">
                                        {[1, 2, 3].map((s) => (
                                            <div
                                                key={s}
                                                className={`h-2 flex-1 rounded-full transition-colors ${
                                                    s <= step ? 'bg-white' : 'bg-blue-400/40'
                                                }`}
                                            />
                                        ))}
                                    </div>
                                )}
                            </div>

                            <div className="p-6">
                                {renderStep()}
                            </div>
                        </div>

                        <p className="text-center text-gray-500 text-sm mt-6">
                            Drevet av Claude AI ‚Ä¢ Fokusgruppe-simulering
                        </p>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<AdPredictionAgent />, document.getElementById('root'));
    </script>
</body>
</html>
